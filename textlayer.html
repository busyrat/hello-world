<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>text layer example</title>
    <link rel="stylesheet" href="https://unpkg.com/pdfjs-dist/web/pdf_viewer.css" />
    <script src="https://unpkg.com/pdfjs-dist/build/pdf.js"></script>
    <script src="https://unpkg.com/pdfjs-dist/web/pdf_viewer.js"></script>
  </head>
  <body>
    <h1>text layer example</h1>

    <div id="container" style="position: relative;"></div>

    <script id="script">
      console.log(pdfjsViewer)
      //
      // If absolute URL from the remote server is provided, configure the CORS
      // header on that server.
      //
      var url = './hello2.pdf'

      //
      // The workerSrc property shall be specified.
      //
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist/build/pdf.worker.js'

      //
      // Asynchronous download PDF
      //
      var loadingTask = pdfjsLib.getDocument(url)
      loadingTask.promise.then(function (pdf) {
        //
        // Fetch the first page
        //
        pdf.getPage(1).then(function (page) {
          var scale = 1
          var viewport = page.getViewport({ scale: scale })

          //
          // Prepare canvas using PDF page dimensions
          //
          var canvas = document.createElement('canvas')
          var container = document.getElementById('container')
          container.appendChild(canvas)
          var context = canvas.getContext('2d')
          canvas.height = viewport.height
          canvas.width = viewport.width

          //
          // Render PDF page into canvas context
          //
          var renderContext = {
            canvasContext: context,
            viewport: viewport,
          }
          page.render(renderContext)

          // 渲染文本
          page.getTextContent().then(function (textContent) {
            // 创建文本图层div
            const textLayerDiv = document.createElement('div')
            textLayerDiv.setAttribute('class', 'textLayer')
            // 将文本图层div添加至每页pdf的div中
            container.appendChild(textLayerDiv)

            // // 创建新的TextLayerBuilder实例
            var textLayer = new pdfjsViewer.TextLayerBuilder({
              textLayerDiv: textLayerDiv,
              pageIndex: page.pageIndex,
              viewport: viewport,
            })
            textLayer.setTextContent(textContent)

            textLayer.render()
          })
        })
      })
    </script>
  </body>
</html>
